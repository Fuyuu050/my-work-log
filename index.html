<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥æ™‚åŠ©æ‰‹ (å«è‡ªå‹•è¨ˆç®—)</title>
    <style>
        body { font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f8f9fa; color: #333; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); width: 100%; max-width: 350px; text-align: center; }
        #clock { font-size: 1.4rem; color: #444; margin-bottom: 5px; font-weight: bold; }
        #today-summary { background: #e7f3ff; color: #007bff; padding: 10px; border-radius: 10px; margin-bottom: 20px; font-size: 14px; font-weight: bold; }
        button { width: 100%; padding: 15px; margin: 8px 0; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-in { background: #28a745; color: white; }
        .btn-out { background: #007bff; color: white; }
        .btn-export { background: #ffc107; color: #333; margin-top: 15px; }
        .log-container { margin-top: 25px; width: 100%; max-width: 350px; }
        ul { list-style: none; padding: 0; }
        li { background: white; margin-bottom: 8px; padding: 12px; border-radius: 10px; font-size: 13px; border-left: 5px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .type-tag { font-weight: bold; padding: 2px 8px; border-radius: 4px; color: white; }
    </style>
</head>
<body>

<div class="card">
    <div id="clock">00:00:00</div>
    <div id="today-summary">ä»Šæ—¥ç´¯è¨ˆå·¥æ™‚ï¼š0 å°æ™‚ 0 åˆ†</div>
    <button class="btn-in" onclick="addLog('ä¸Šç­')">â–¶ ä¸Šç­æ‰“å¡</button>
    <button class="btn-out" onclick="addLog('ä¸‹ç­')">â–  ä¸‹ç­æ‰“å¡</button>
    <button class="btn-export" onclick="exportCSV()">ğŸ“ åŒ¯å‡ºæœ¬æœˆ CSV</button>
    <button style="background:none; color:#ccc; font-size:11px;" onclick="clearLogs()">æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
</div>

<div class="log-container">
    <h3>æœ€è¿‘ç´€éŒ„</h3>
    <ul id="logList"></ul>
</div>

<script>
    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString('zh-TW', { hour12: false });
    }
    setInterval(updateClock, 1000);

    function addLog(type) {
        const now = new Date();
        const entry = {
            type: type,
            timestamp: now.getTime(),
            date: now.toLocaleDateString('zh-TW'),
            time: now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false })
        };
        let logs = JSON.parse(localStorage.getItem('workLogs') || "[]");
        logs.unshift(entry);
        localStorage.setItem('workLogs', JSON.stringify(logs));
        render();
    }

    function calculateTodayHours(logs) {
        const today = new Date().toLocaleDateString('zh-TW');
        const todayLogs = logs.filter(l => l.date === today).reverse();
        let totalMs = 0;
        let lastInTime = null;

        todayLogs.forEach(log => {
            if (log.type === 'ä¸Šç­') {
                lastInTime = log.timestamp;
            } else if (log.type === 'ä¸‹ç­' && lastInTime) {
                totalMs += (log.timestamp - lastInTime);
                lastInTime = null;
            }
        });

        const totalMinutes = Math.floor(totalMs / 1000 / 60);
        const h = Math.floor(totalMinutes / 60);
        const m = totalMinutes % 60;
        return { h, m };
    }

    function render() {
        const logs = JSON.parse(localStorage.getItem('workLogs') || "[]");
        
        // æ›´æ–°ä»Šæ—¥çµ±è¨ˆ
        const summary = calculateTodayHours(logs);
        document.getElementById('today-summary').innerText = `ä»Šæ—¥ç´¯è¨ˆå·¥æ™‚ï¼š${summary.h} å°æ™‚ ${summary.m} åˆ†`;

        // æ›´æ–°åˆ—è¡¨
        const list = document.getElementById('logList');
        list.innerHTML = logs.slice(0, 10).map(l => `
            <li>
                <span class="type-tag" style="background:${l.type === 'ä¸Šç­' ? '#28a745' : '#007bff'}">${l.type}</span>
                <span>${l.date} ${l.time}</span>
            </li>
        `).join('');
    }

    function exportCSV() {
        const logs = JSON.parse(localStorage.getItem('workLogs') || "[]");
        if (logs.length === 0) return alert("æ²’æœ‰è³‡æ–™å¯åŒ¯å‡º");

        let csv = "\uFEFFæ—¥æœŸ,é¡å‹,æ™‚é–“\n";
        logs.forEach(l => { csv += `${l.date},${l.type},${l.time}\n`; });

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `å·¥æ™‚ç´€éŒ„_${new Date().getMonth()+1}æœˆ.csv`;
        a.click();
    }

    function clearLogs() { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) { localStorage.removeItem('workLogs'); render(); } }

    render();
</script>

</body>
</html>
