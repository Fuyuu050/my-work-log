function exportCSV() {
        const logs = JSON.parse(localStorage.getItem('workLogs') || "[]");
        if (logs.length === 0) return alert("目前沒有紀錄可匯出！");

        // 排序：從舊到新計算
        const sortedLogs = [...logs].sort((a, b) => a.timestamp - b.timestamp);

        let csvContent = "\uFEFF日期,類型,時間,當次工時/小計\n"; 
        let lastInTime = null;
        let totalMinutesAll = 0; // 用來累計總分鐘數

        sortedLogs.forEach((l) => {
            let durationStr = "";
            
            if (l.type === '上班') {
                lastInTime = l.timestamp;
            } else if (l.type === '下班' && lastInTime) {
                const diffMs = l.timestamp - lastInTime;
                const diffMin = Math.floor(diffMs / 60000);
                totalMinutesAll += diffMin; // 累計總數
                
                const h = Math.floor(diffMin / 60);
                const m = diffMin % 60;
                durationStr = `${h} 小時 ${m} 分`;
                lastInTime = null; 
            }

            csvContent += `${l.date},${l.type},${l.time},${durationStr}\n`;
        });

        // 計算總工時
        const totalH = Math.floor(totalMinutesAll / 60);
        const totalM = totalMinutesAll % 60;

        // 在 CSV 最後增加空行和總計行
        csvContent += `\n,,,總累計工時：${totalH} 小時 ${totalM} 分\n`;

        // 下載檔案邏輯
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", `工時總結報表_${new Date().toLocaleDateString()}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
