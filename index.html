<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥æ™‚åŠ©æ‰‹ Pro</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f4f7f9; color: #333; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); width: 100%; max-width: 350px; text-align: center; position: relative; }
        #clock { font-size: 1.4rem; color: #444; margin-bottom: 5px; font-weight: bold; }
        #today-summary { background: #e7f3ff; color: #007bff; padding: 10px; border-radius: 10px; margin-bottom: 20px; font-size: 14px; font-weight: bold; }
        
        button { width: 100%; padding: 14px; margin: 6px 0; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.98); opacity: 0.9; }
        .btn-in { background: #28a745; color: white; }
        .btn-out { background: #007bff; color: white; }
        .btn-manual { background: #6c757d; color: white; font-size: 14px; }
        .btn-export { background: #ffc107; color: #333; margin-top: 15px; }

        /* å½ˆçª—æ¨£å¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; width: 85%; max-width: 300px; text-align: left; }
        .modal-content h3 { margin-top: 0; }
        input, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }

        .log-container { margin-top: 25px; width: 100%; max-width: 350px; }
        ul { list-style: none; padding: 0; }
        li { background: white; margin-bottom: 8px; padding: 12px; border-radius: 10px; font-size: 13px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .tag { font-weight: bold; padding: 2px 8px; border-radius: 4px; color: white; font-size: 11px; }
    </style>
</head>
<body>

<div class="card">
    <div id="clock">00:00:00</div>
    <div id="today-summary">ä»Šæ—¥ç´¯è¨ˆå·¥æ™‚ï¼š0 å°æ™‚ 0 åˆ†</div>
    <button class="btn-in" onclick="addLog('ä¸Šç­')">â–¶ ç¾åœ¨ä¸Šç­æ‰“å¡</button>
    <button class="btn-out" onclick="addLog('ä¸‹ç­')">â–  ç¾åœ¨ä¸‹ç­æ‰“å¡</button>
    <button class="btn-manual" onclick="toggleModal(true)">ğŸ•’ è£œç°½æ­·å²ç´€éŒ„</button>
    <button class="btn-export" onclick="exportCSV()">ğŸ“ åŒ¯å‡º CSV</button>
    <button style="background:none; color:#ccc; font-size:11px; margin-top:10px;" onclick="clearLogs()">æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
</div>

<div id="manualModal" class="modal">
    <div class="modal-content">
        <h3>è£œç°½ç´€éŒ„</h3>
        <label>é¡å‹ï¼š</label>
        <select id="m-type">
            <option value="ä¸Šç­">ä¸Šç­</option>
            <option value="ä¸‹ç­">ä¸‹ç­</option>
        </select>
        <label>æ—¥æœŸèˆ‡æ™‚é–“ï¼š</label>
        <input type="datetime-local" id="m-datetime">
        <button class="btn-in" onclick="saveManualLog()">ç¢ºèªè£œç°½</button>
        <button class="btn-manual" style="background:#eee; color:#333;" onclick="toggleModal(false)">å–æ¶ˆ</button>
    </div>
</div>

<div class="log-container">
    <h3>æ‰“å¡æ˜ç´°</h3>
    <ul id="logList"></ul>
</div>

<script>
    function updateClock() {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('zh-TW', { hour12: false });
    }
    setInterval(updateClock, 1000);

    // é–‹é—œå½ˆçª—
    function toggleModal(show) {
        const modal = document.getElementById('manualModal');
        modal.style.display = show ? 'flex' : 'none';
        if(show) {
            // é è¨­æ™‚é–“ç‚ºç¾åœ¨
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('m-datetime').value = now.toISOString().slice(0, 16);
        }
    }

    // å„²å­˜ä¸€èˆ¬ç´€éŒ„
    function addLog(type) {
        saveToStorage({
            type: type,
            timestamp: new Date().getTime(),
            date: new Date().toLocaleDateString('zh-TW'),
            time: new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false })
        });
    }

    // å„²å­˜è£œç°½ç´€éŒ„
    function saveManualLog() {
        const type = document.getElementById('m-type').value;
        const dtValue = document.getElementById('m-datetime').value;
        if(!dtValue) return alert("è«‹é¸æ“‡æ™‚é–“");

        const dt = new Date(dtValue);
        saveToStorage({
            type: type,
            timestamp: dt.getTime(),
            date: dt.toLocaleDateString('zh-TW'),
            time: dt.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false })
        });
        toggleModal(false);
    }

    function saveToStorage(entry) {
        let logs = JSON.parse(localStorage.getItem('workLogs') || "[]");
        logs.push(entry);
        // æŒ‰æ™‚é–“æ’åº (æ–°åˆ°èˆŠ)
        logs.sort((a, b) => b.timestamp - a.timestamp);
        localStorage.setItem('workLogs', JSON.stringify(logs));
        render();
    }

    function calculateTodayHours(logs) {
        const today = new Date().toLocaleDateString('zh-TW');
        // è¨ˆç®—æ™‚éœ€ç”¨èˆŠåˆ°æ–°æ’åº
        const todayLogs = logs.filter(l => l.date === today).sort((a,b) => a.timestamp - b.timestamp);
        let totalMs = 0, lastInTime = null;

        todayLogs.forEach(log => {
            if (log.type === 'ä¸Šç­') lastInTime = log.timestamp;
            else if (log.type === 'ä¸‹ç­' && lastInTime) {
                totalMs += (log.timestamp - lastInTime);
                lastInTime = null;
            }
        });
        const totalMin = Math.floor(totalMs / 60000);
        return { h: Math.floor(totalMin/60), m: totalMin%60 };
    }

    function render() {
        const logs = JSON.parse(localStorage.getItem('workLogs') || "[]");
        const summary = calculateTodayHours(logs);
        document.getElementById('today-summary').innerText = `ä»Šæ—¥ç´¯è¨ˆå·¥æ™‚ï¼š${summary.h} å°æ™‚ ${summary.m} åˆ†`;

        document.getElementById('logList').innerHTML = logs.slice(0, 20).map(l => `
            <li>
                <span class="tag" style="background:${l.type === 'ä¸Šç­' ? '#28a745' : '#007bff'}">${l.type}</span>
                <span style="color:#666">${l.date}</span>
                <span style="font-weight:bold">${l.time}</span>
            </li>
        `).join('');
    }

    function exportCSV() {
        const logs = JSON.parse(localStorage.getItem('workLogs') || "[]");
        if (!logs.length) return alert("ç„¡è³‡æ–™");
        let csv = "\uFEFFæ—¥æœŸ,é¡å‹,æ™‚é–“\n" + logs.map(l => `${l.date},${l.type},${l.time}`).join("\n");
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `å·¥æ™‚ç´€éŒ„_${new Date().toLocaleDateString()}.csv`;
        a.click();
    }

    function clearLogs() { if(confirm("ç¢ºå®šåˆªé™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) { localStorage.removeItem('workLogs'); render(); } }

    render();
</script>

</body>
</html>
